generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
}

enum EventType {
  event
  task
}

enum EventStatus {
  pending
  done
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  name         String
  passwordHash String
  createdAt    DateTime @default(now())
  events       Event[]
  eventSeries  EventSeries[]
}

model Event {
  id                  String       @id @default(uuid())
  userId              String
  user                User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  title               String
  description         String
  date                String
  time                String?
  type                EventType
  status              EventStatus  @default(pending)
  categoryId          String?
  recurrenceSeriesId  String?
  recurrenceSeries    EventSeries? @relation(fields: [recurrenceSeriesId], references: [id], onDelete: SetNull)
  recurrenceException Boolean      @default(false)
  revision            Int          @default(0)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  @@index([userId, date, time])
  @@index([userId, recurrenceSeriesId, date])
}

model EventSeries {
  id                  String      @id @default(uuid())
  userId              String
  user                User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  title               String
  description         String
  time                String?
  type                EventType
  status              EventStatus @default(pending)
  startDate           String
  recurrenceFrequency String
  recurrenceInterval  Int
  recurrenceCount     Int?
  recurrenceUntil     String?
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  events              Event[]

  @@index([userId, startDate])
}

model IntegrationConfig {
  key       String   @id
  value     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
