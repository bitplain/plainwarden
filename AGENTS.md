# AGENTS.md

## Общие правила
- Работать строго по этим правилам.
- Ничего не додумывать и не делать “по своему” вне рамок задачи.
- Цель изменений: **лучшее решение** по качеству/надёжности/поддерживаемости в рамках задачи, а не “лишь бы минимально”.
- Приоритет: корректность, безопасность, читаемость, поддерживаемость.
- Запрещено раздувать объём работ “просто потому что можно”: улучшения только если они **прямо усиливают решение задачи**.

---

## 1. Сначала документация (MCP) — потом код
Перед тем как писать или менять код, ОБЯЗАТЕЛЬНО:

1) Сходить в **context7**:
   - определить нужные библиотеки/пакеты (если применимо)
   - найти и прочитать релевантную документацию по версии, которую использует проект

2) Затем сходить в **ref** (второй источник):
   - найти доп.страницы/примеры/гайды по той же теме
   - сверить детали (API, edge-cases, ограничения, best-practices)

3) На основе двух источников:
   - кратко **сравнить** найденные подходы/рекомендации
   - предложить **2–3 варианта реализации** (если есть выбор), с короткими плюсами/минусами
   - при необходимости указать рекомендуемый вариант с обоснованием

4) Только после явного выбора пользователя вносить изменения в код.

---

### ОБЯЗАТЕЛЬНОЕ ПРАВИЛО ВЫБОРА ВАРИАНТА

Если агент предложил 2–3 варианта реализации:

- Агент НЕ ИМЕЕТ ПРАВА самостоятельно выбирать вариант.
- Даже если один вариант помечен как “рекомендуемый”.
- Даже если он объективно выглядит лучше.
- Даже если ранее пользователь обычно выбирал рекомендуемый.

После предложения вариантов агент обязан:

1) Явно остановиться.
2) Попросить пользователя выбрать вариант.
3) НЕ продолжать реализацию до явного подтверждения.

Допускается:
- кратко отметить “рекомендуемый” вариант с техническим обоснованием.

Запрещено:
- автоматически начинать реализацию рекомендуемого варианта.
- считать молчание согласием.
- интерпретировать неоднозначный ответ как выбор.
- продолжать работу без прямого подтверждения пользователя.

Продолжение работы возможно только после явного выбора пользователя  
(пример: “Выбираю вариант 2”).

---

Если в MCP нет нужной информации:
- Явно написать, чего не хватает и где именно “дыра”.
- Действовать осторожно, но **ориентироваться на best-practices** и здравый смысл проекта.
- Не придумывать несуществующие API/поведение.

---

## 2. Работа ТОЛЬКО через ветки и Pull Request (и всегда новый PR)

При ЛЮБЫХ изменениях кода:
- исправления
- улучшения
- рефакторинг
- новый функционал

ПРЯМОЙ ЗАПРЕТ:
- Нельзя работать в `main` / `master`.
- Нельзя делать merge.
- Нельзя “обновлять существующий PR” допушем в ту же ветку.
- Нельзя “тихо продолжать” уже открытый PR.

Правильный порядок (каждый заход = новый PR):

1) Создать **НОВУЮ** git-ветку под конкретную задачу/итерацию  
   Примеры:
   - `fix/название`
   - `feature/название`
   - `refactor/название`
   - `chore/название`

2) Внести изменения ТОЛЬКО в этой ветке.
3) Сделать commit(ы).
4) Запушить ветку в GitHub.
5) Создать **НОВЫЙ Pull Request** в основную ветку.

ВАЖНО (контроль владельцем репозитория):
- Агент НИКОГДА не принимает и не мержит Pull Request.
- Слияние делает ТОЛЬКО владелец репозитория вручную.
- После создания PR агент останавливается и ждёт дальнейших указаний.

Правило “новый PR всегда”:
- Даже если правка маленькая — делать новый PR.
- Если уже есть открытый PR по теме:
  - НЕ допушивать в его ветку.
  - Создать новую ветку и новый PR.
  - В описании нового PR сослаться на предыдущий (например: “follow-up к PR #123”).

---

## 3. План перед изменениями

Перед тем как менять код, агент ОБЯЗАН:
- Кратко описать план действий.
- Указать список файлов, которые будут изменены.
- Явно обозначить, какие улучшения делаются “для качества” и почему они нужны именно для этой задачи.

Запрещено:
- Вносить дополнительные изменения “заодно”.
- Делать рефакторинг, не связанный напрямую с задачей.

---

## 3.1 Definition of Done (обязательные критерии готовности)

Перед началом реализации агент ОБЯЗАН сформулировать критерии готовности задачи.

Формат:

### Definition of Done
Задача считается выполненной, когда:

- [ ] ...
- [ ] ...
- [ ] ...
- [ ] ...

Требования:

- Критерии должны быть измеримыми и проверяемыми.
- Не допускаются расплывчатые формулировки.
- Если критерии неочевидны — агент предлагает варианты критериев и
  ОСТАНАВЛИВАЕТСЯ до подтверждения пользователя.

Запрещено:
- Начинать реализацию без зафиксированного Definition of Done.
---

## 4. Показ изменений (diff)

Перед коммитом или PR обязательно показать:
- `git diff --stat`
- ключевые части `git diff`

---

## 5. Зависимости

- Нельзя добавлять, обновлять или удалять зависимости без явного разрешения.
- Lock-файлы не трогать без необходимости.

---

## 6. Тесты и проверки

Если в проекте есть тесты или линтеры:
- Запускать их и писать результат.

Если тестов нет:
- Не выдумывать новые тестовые фреймворки без запроса.
- Можно добавить минимальный тест, если он напрямую усиливает решение задачи и не требует новых зависимостей.

---

## 7. Безопасность

- Никогда не коммитить пароли, токены, ключи.
- Для примеров использовать `.env.example`.
- Реальные секреты в код не добавлять.

---

## 8. Качество и стиль кода (ориентир на best-practices)

- Следовать существующему стилю проекта.
- Предпочитать решения:
  - с понятной структурой,
  - с хорошими именами,
  - с предсказуемым поведением,
  - с обработкой ошибок и краевых случаев,
  - с читаемыми интерфейсами.
- Разрешён рефакторинг, если он:
  - снижает сложность,
  - улучшает поддержку,
  - уменьшает риски,
  и остаётся в рамках задачи.
- Запрещён массовый рефакторинг без запроса.

---

## 9. Коммиты

Формат сообщений коммита:
- `fix: ...`
- `feat: ...`
- `refactor: ...`
- `chore: ...`

---

## 10. Язык общения (ОБЯЗАТЕЛЬНО)

- Все ответы, объяснения, планы, комментарии, сообщения и выводы агента
  должны быть написаны ИСКЛЮЧИТЕЛЬНО на русском языке.
- Это правило распространяется на:
  - ответы агента
  - результаты skills
  - объяснения ошибок
  - вопросы пользователю
  - планы и выводы

Английский язык допускается ТОЛЬКО:
- внутри кода
- в логах
- в сообщениях компилятора / ошибок
- в цитатах из документации

Если результат skills или MCP получен на английском,
агент ОБЯЗАН:
- понять его
- пересказать смысл на русском языке.

---

## Handoff

После завершения работы агент обязан:

- Кратко зафиксировать:
  - что сделано
  - что не сделано
  - что требует внимания
  - что проверить вручную

Формат допускается в виде:
- отдельного файла HANDOFF.md
или
- отдельного блока в конце отчёта перед остановкой.

Агент обязан остановиться после handoff.

---